{"version":3,"sources":["index.js"],"names":["dispatch","listen","connect","apply","state","listeners","containers","middleware","callbackOnion","coreFunction","action","type","i","length","rerender","sort","a","b","priority","reduce","nextLayer","layer","func","currentAction","Array","isArray","updater","enqueueForceUpdate","callback","push","container","newMiddleware","unshift"],"mappings":";;;;;QA2CgBA,Q,GAAAA,Q;QA+BAC,M,GAAAA,M;QAKAC,O,GAAAA,O;QAIAC,K,GAAAA,K;AAnFhB;;;;;;;;;;;;;;;;;;;;;;;;;AAyBO,IAAIC,wBAAQ,EAAZ;AACP,IAAIC,YAAY,EAAhB;AACA,IAAIC,aAAa,EAAjB;AACA,IAAIC,aAAa,EAAjB;;AAEA;AACA;AACA,IAAIC,gBAAgB,IAApB;;AAEA,IAAMC,eAAe,SAAfA,YAAe,SAAU;AAC9B,KAAIJ,UAAUK,OAAOC,IAAjB,CAAJ,EAA6B;AAC5B,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIP,UAAUK,OAAOC,IAAjB,EAAuBE,MAA3C,EAAmDD,GAAnD,EAAyD;AACxD,WAZQR,KAYR,WAAQC,UAAUK,OAAOC,IAAjB,EAAuBC,CAAvB,EAA0BR,KAA1B,EAAiCM,MAAjC,CAAR;AACA;AACD;AACD,QAAON,KAAP;AACA,CAPD;;AASO,SAASJ,QAAT,CAAkBU,MAAlB,EAA2C;AAAA,KAAjBI,QAAiB,yDAAN,IAAM;;AACjD,KAAIN,kBAAkB,IAAtB,EAA6B;AAC5BD,aAAWQ,IAAX,CAAgB,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACzB,UAAOD,EAAEE,QAAF,GAAaD,EAAEC,QAAtB;AACA,GAFD;AAGA;AACA;AACA;AACA;AACA;AACA;AACAV,kBAAgBD,WAAWY,MAAX,CAAkB,UAACC,SAAD,EAAYC,KAAZ,EAAsB;AACvD,UAAO,yBAAiB;AACvB,WAAOA,MAAMC,IAAN,CAAWC,aAAX,EAA0BH,SAA1B,CAAP;AACA,IAFD;AAGA,GAJe,EAIbX,YAJa,CAAhB;AAKA;AACD,KAAI,CAACe,MAAMC,OAAN,CAAcf,MAAd,CAAL,EAA6B;AAC5BA,WAAS,CAACA,MAAD,CAAT;AACA;AACD,KAAIE,CAAJ;AACA,MAAKA,IAAI,CAAT,EAAYA,IAAIF,OAAOG,MAAvB,EAA+BD,GAA/B,EAAqC;AACpC,UAxCSR,KAwCT,WAAQI,cAAcE,OAAOE,CAAP,CAAd,CAAR;AACA;AACD,KAAIE,QAAJ,EAAe;AACd,OAAKF,IAAI,CAAT,EAAYA,IAAIN,WAAWO,MAA3B,EAAmCD,GAAnC,EAAyC;AACxCN,cAAWM,CAAX,EAAcc,OAAd,CAAsBC,kBAAtB,CAAyCrB,WAAWM,CAAX,CAAzC;AACA;AACD;AACD;;AAEM,SAASX,MAAT,CAAgBU,IAAhB,EAAsBiB,QAAtB,EAAgC;AACtCvB,WAAUM,IAAV,IAAkBN,UAAUM,IAAV,KAAmB,EAArC;AACAN,WAAUM,IAAV,EAAgBkB,IAAhB,CAAqBD,QAArB;AACA;;AAEM,SAAS1B,OAAT,CAAiB4B,SAAjB,EAA4B;AAClCxB,YAAWuB,IAAX,CAAgBC,SAAhB;AACA;;AAEM,SAAS3B,KAAT,CAAe4B,aAAf,EAA4C;AAAA,KAAdb,QAAc,yDAAH,CAAG;;AAClDX,YAAWyB,OAAX,CAAmB,EAAEd,kBAAF,EAAYI,MAAMS,aAAlB,EAAnB;AACA;AACAvB,iBAAgB,IAAhB;AACA","file":"index.js","sourcesContent":["/*\n * Minimux v1.0.0\n * Author: Steven Barnett (stevendesu) <steven.abarnett@gmail.com>\n * License: MIT +no-false-attribs (https://spdx.org/licenses/MITNFA.html)\n * \n * I made this library because I liked the ideology of Redux, but not the\n * implementation. This is my attempt to rebuild Redux with absolute minimal\n * functionality and to allow for absolute minimal bootstrapping in order to\n * write effective code.\n *\n * TODO (for anyone who wants to contribute):\n *  - There's currently no error handling or exception throwing. Pass an integer\n *    to dispatch() and the whole thing explodes\n * \n * Considerations:\n *  - Two of our functions (connect and apply) are one-liners... why not just\n *    make \"containers\" and \"middleware\" public?\n *  - What should be the return values of each function?\n *  - How do you UNbind middleware or DISconnect containers? Or UNlisten?\n *  - Should it be possible to connect to a subset of the state? If you could\n *    bind reducers to subsets of state then it would be more modular\n *  - Could we add support for CJS, AMD, and UMD? Maybe as a build step?\n *  - \n */\n\nexport var state = {};\nlet listeners = {};\nlet containers = [];\nlet middleware = [];\n\n// The \"onion\" describes the layers of middleware that we must parse through\n// in order to execute our action.\nvar callbackOnion = null;\n\nconst coreFunction = action => {\n\tif( listeners[action.type] ) {\n\t\tfor( var i = 0; i < listeners[action.type].length; i++ ) {\n\t\t\tstate = listeners[action.type][i](state, action);\n\t\t}\n\t}\n\treturn state;\n}\n\nexport function dispatch(action, rerender = true) {\n\tif( callbackOnion === null ) {\n\t\tmiddleware.sort((a, b) => {\n\t\t\treturn a.priority - b.priority;\n\t\t});\n\t\t// This function isn't ugly on purpose. I just copied the functionality of\n\t\t// PHP's Onion library (https://github.com/esbenp/onion/) and translated\n\t\t// to JavaScript, leaving out unnecessary calls like call_user_func_array\n\t\t//\n\t\t// I'm open to anyone who can rewrite this to be a little more obvious\n\t\t// what's going on\n\t\tcallbackOnion = middleware.reduce((nextLayer, layer) => {\n\t\t\treturn currentAction => {\n\t\t\t\treturn layer.func(currentAction, nextLayer);\n\t\t\t};\n\t\t}, coreFunction)\n\t}\n\tif( !Array.isArray(action) ) {\n\t\taction = [action];\n\t}\n\tvar i;\n\tfor( i = 0; i < action.length; i++ ) {\n\t\tstate = callbackOnion(action[i]);\n\t}\n\tif( rerender ) {\n\t\tfor( i = 0; i < containers.length; i++ ) {\n\t\t\tcontainers[i].updater.enqueueForceUpdate(containers[i]);\n\t\t}\n\t}\n}\n\nexport function listen(type, callback) {\n\tlisteners[type] = listeners[type] || [];\n\tlisteners[type].push(callback);\n}\n\nexport function connect(container) {\n\tcontainers.push(container);\n}\n\nexport function apply(newMiddleware, priority = 0) {\n\tmiddleware.unshift({ priority, func: newMiddleware });\n\t// Additional middleware was added. We need to recalulate this guy.\n\tcallbackOnion = null;\n}\n"],"sourceRoot":"/source/"}